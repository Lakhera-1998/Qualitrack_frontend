<div class="testcases-container">
  <div class="header">
    <h2>Test Cases</h2>
    <div class="header-buttons">
      <!-- New buttons for template download and bulk import -->
      <button class="template-btn" (click)="downloadTemplate()" [disabled]="!selectedRequirementId">
        üì• Download Template
      </button>
      <button class="import-btn" (click)="openImportPopup()" [disabled]="!selectedRequirementId">
        üì§ Import Test Cases
      </button>
      <button class="add-btn" (click)="openAddTestCasePopup()" [disabled]="!selectedRequirementId">+ Add Test Case</button>
    </div>
  </div>

  <!-- Client, Project, and Requirement Filters -->
  <div class="filters-card card">
    <h3>Filter Test Cases</h3>
    <div class="filter-form">
      <div class="form-group">
        <label for="clientSelect">Client *</label>
        <select id="clientSelect" [(ngModel)]="selectedClientId" (change)="onClientChange()" class="form-control">
          <option value="">Select Client</option>
          <option *ngFor="let client of clients" [value]="client.id">{{ client.client_name }}</option>
        </select>
      </div>

      <div class="form-group">
        <label for="projectSelect">Project *</label>
        <select id="projectSelect" [(ngModel)]="selectedProjectId" (change)="onProjectChange()" class="form-control" [disabled]="!selectedClientId">
          <option value="">Select Project</option>
          <option *ngFor="let project of filteredProjects" [value]="project.id">{{ project.project_name }}</option>
        </select>
      </div>

      <div class="form-group">
        <label for="requirementSelect">Requirement *</label>
        <select id="requirementSelect" [(ngModel)]="selectedRequirementId" (change)="onRequirementChange()" class="form-control" [disabled]="!selectedProjectId">
          <option value="">Select Requirement</option>
          <option *ngFor="let requirement of filteredRequirements" [value]="requirement.id">{{ requirement.requirement_title }}</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Test Cases Display Area -->
  <div *ngIf="selectedRequirementId && requirement" class="requirements-content">
    <div class="project-header">
      <!-- ‚úÖ Fixed heading display to avoid showing (-) unnecessarily -->
      <h3>
        Test Cases for {{ requirement?.requirement_title }}
        <span *ngIf="selectedProjectName || selectedClientName">
          ({{ selectedProjectName }}<span *ngIf="selectedProjectName && selectedClientName"> - </span>{{ selectedClientName }})
        </span>
      </h3>
    </div>

    <div class="card table-card">
      <!-- ‚úÖ Table Container without vertical scroll -->
      <div class="table-scroll-container">
        <table class="styled-table">
          <thead>
            <tr>
              <th class="col-sno">S. No.</th>
              <th class="col-test-case-id">Test Case ID</th>
              <th class="col-title">Title</th>
              <th class="col-page-name">Page Name</th>
              <th>Status</th>
              <th>Bug Status</th>
              <th class="col-boolean">Is Automated</th>
              <th class="col-boolean">Is Executed</th>
              <th class="col-boolean">Bug Raised</th>
              <th>Bug Screenshot</th>
              <th>Assigned To</th>
              <th>Executed By</th>
              <th class="col-datetime">Executed On</th>
              <th>Created By</th>
              <th class="col-datetime">Created At</th>
              <th class="actions-header">Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- ‚úÖ Updated to use paginatedTestCases with proper serial number -->
            <tr *ngFor="let testCase of paginatedTestCases(); let i = index">
              <!-- Serial Number -->
              <td class="col-sno">{{ (currentPage - 1) * pageSize + i + 1 }}</td>
              
              <!-- Test Case ID - Now clickable -->
              <td class="col-test-case-id">
                <div class="clickable-text wrapped-text" 
                     (click)="navigateToTestCaseDetails(testCase)"
                     title="Click to view test case details">
                  {{ testCase.test_case_id || '-' }}
                </div>
              </td>
              
              <!-- Title with wrapping and clickable -->
              <td class="col-title">
                <div class="clickable-text wrapped-text"
                     (click)="navigateToTestCaseDetails(testCase)"
                     title="Click to view test case details">
                  {{ testCase.title }}
                </div>
              </td>

              <!-- Page Name with wrapping -->
              <td class="col-page-name">
                <div class="wrapped-text">{{ testCase.page_name || '-' }}</div>
              </td>

              <!-- Status -->
              <td>
                <span class="status-badge {{ testCase.status?.toLowerCase()?.replace(' ', '-') || 'pending' }}">
                  {{ testCase.status || 'Not tested yet' }}
                </span>
              </td>

              <!-- Bug Status -->
              <td>
                <span *ngIf="testCase.bug_status"
                      class="bug-status-badge {{ testCase.bug_status?.toLowerCase().replace(' ', '-') }}">
                  {{ testCase.bug_status }}
                </span>
                <span *ngIf="!testCase.bug_status">-</span>
              </td>

              <!-- Is Automated -->
              <td class="col-boolean">
                <span [ngClass]="testCase.is_automated ? 'icon-yes' : 'icon-no'">
                  {{ testCase.is_automated ? '‚úî' : '‚úñ' }}
                </span>
              </td>

              <!-- Is Executed -->
              <td class="col-boolean">
                <span [ngClass]="testCase.is_executed ? 'icon-yes' : 'icon-no'">
                  {{ testCase.is_executed ? '‚úî' : '‚úñ' }}
                </span>
              </td>

              <!-- Bug Raised -->
              <td class="col-boolean">
                <span [ngClass]="testCase.bug_raised ? 'icon-yes' : 'icon-no'">
                  {{ testCase.bug_raised ? '‚úî' : '‚úñ' }}
                </span>
              </td>

              <!-- Bug Screenshot -->
              <td>
                <div *ngIf="testCase.bug_screenshot" class="screenshot-preview">
                  <img [src]="testCase.bug_screenshot" alt="Bug Screenshot" 
                       (click)="viewScreenshot(testCase.bug_screenshot)" 
                       class="screenshot-thumbnail">
                </div>
                <span *ngIf="!testCase.bug_screenshot">-</span>
              </td>

              <!-- Assigned To with wrapping -->
              <td>{{ getDeveloperDisplay(testCase.assigned_to) }}</td>

              <!-- Executed By with wrapping -->
              <td>{{ getUsername(testCase.executed_by) }}</td>
              
              <!-- Executed On - NO WRAPPING -->
              <td class="col-datetime">{{ testCase.executed_on ? (testCase.executed_on | date:'medium') : '-' }}</td>
              
              <!-- Created By with wrapping -->
              <td>{{ getUsername(testCase.created_by) }}</td>
              
              <!-- Created At - NO WRAPPING -->
              <td class="col-datetime">{{ testCase.created_at ? (testCase.created_at | date:'medium') : '-' }}</td>

              <!-- Actions - Removed eye icon -->
              <td class="actions">
                <button class="edit-btn" (click)="editTestCase(testCase)" title="Edit Test Case">‚úèÔ∏è</button>
                <button class="execute-btn" (click)="executeTestCase(testCase)"
                        *ngIf="!testCase.is_executed" title="Execute Test Case">‚ñ∂Ô∏è</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- ‚úÖ Pagination -->
      <div class="pagination-container" *ngIf="testCases.length > 0">
        <div class="pagination-summary">
          Showing {{ getStartIndex() }}-{{ getEndIndex() }} of {{ testCases.length }} records
        </div>
        <div class="pagination-controls">
          <button 
            class="pagination-btn" 
            [disabled]="currentPage === 1" 
            (click)="goToPage(currentPage - 1)">
            Previous
          </button>
          
          <button 
            *ngFor="let page of getVisiblePages()" 
            class="pagination-btn" 
            [class.active]="page === currentPage"
            (click)="goToPage(page)">
            {{ page }}
          </button>
          
          <button 
            class="pagination-btn" 
            [disabled]="currentPage === totalPages()" 
            (click)="goToPage(currentPage + 1)">
            Next
          </button>
        </div>
      </div>

      <div *ngIf="testCases.length === 0 && selectedRequirementId" class="no-requirements">
        No test cases found for this requirement.
      </div>
    </div>
  </div>

  <!-- Message when no client/project/requirement selected -->
  <div *ngIf="!selectedRequirementId" class="placeholder-message card">
    <div class="message-content">
      <h3>Select Client, Project and Requirement</h3>
      <p>Select a client, project and requirement from the dropdowns above to display the test cases.</p>
    </div>
  </div>

  <!-- Success Notification -->
  <div *ngIf="showSuccessMessage" class="success-notification">
    <span>{{ successMessage }}</span>
    <button class="close-notification" (click)="hideSuccessMessage()">√ó</button>
  </div>

  <!-- Error Notification -->
  <div *ngIf="showErrorMessage" class="error-notification">
    <span>{{ errorMessage }}</span>
    <button class="close-notification" (click)="hideErrorMessage()">√ó</button>
  </div>

  <!-- Import Test Cases Popup -->
  <div class="popup" *ngIf="showImportPopup">
    <div class="popup-content large-popup">
      <div class="popup-header">
        <h3>Import Test Cases</h3>
        <button class="close-btn" (click)="closeImportPopup()">‚úñ</button>
      </div>

      <div class="import-instructions">
        <h4>Instructions:</h4>
        <ul>
          <li>Download the template first and fill in your test case data</li>
          <li>Only Excel files (.xlsx, .xls) are accepted</li>
          <li>Required fields: Test Case ID, Title, Page Name, Description, Expected Result</li>
          <li>For test data, you can either provide an existing test data ID or new text test data</li>
          <li>Boolean fields (is_automated, is_executed, bug_raised) must be TRUE or FALSE</li>
          <li>Status must be: Pass, Fail, or Not tested yet</li>
          <li>Bug status must be: Open, In Progress, Resolved, or Closed</li>
        </ul>
      </div>

      <div class="file-upload-section">
        <div class="upload-area" 
             [class.active]="isDragOver"
             (drop)="onFileDrop($event)"
             (dragover)="onDragOver($event)"
             (dragleave)="onDragLeave($event)"
             (click)="fileInput.click()">
          <div class="upload-placeholder" *ngIf="!importFile">
            <span class="upload-icon">üìÅ</span>
            <p>Click to browse or drag and drop Excel file here</p>
            <small>Supports .xlsx, .xls files only</small>
          </div>
          <div class="file-preview" *ngIf="importFile">
            <span class="file-icon">üìÑ</span>
            <div class="file-info">
              <strong>{{ importFile.name }}</strong>
              <small>Size: {{ getFileSize(importFile.size) }}</small>
            </div>
            <button type="button" class="remove-btn" (click)="removeImportFile($event)">‚úñ</button>
          </div>
        </div>
        <input #fileInput type="file" (change)="onImportFileSelected($event)" accept=".xlsx,.xls" hidden>
      </div>

      <!-- Validation Results -->
      <div *ngIf="importResults" class="validation-results">
        <div class="result-summary" [class.success]="importResults.success_count > 0 && importResults.error_count === 0"
             [class.warning]="importResults.error_count > 0">
          <strong>
            {{ importResults.success_count }} test cases imported successfully, 
            {{ importResults.error_count }} errors found
          </strong>
        </div>

        <div *ngIf="importResults.errors && importResults.errors.length > 0" class="error-details">
          <h5>Errors:</h5>
          <div *ngFor="let error of importResults.errors" class="error-item">
            <strong>Row {{ error.row }}:</strong>
            <ul>
              <li *ngFor="let err of error.errors">{{ err }}</li>
            </ul>
          </div>
        </div>

        <div *ngIf="importResults.imported_test_cases && importResults.imported_test_cases.length > 0" class="success-details">
          <h5>Imported Test Cases:</h5>
          <div *ngFor="let testCase of importResults.imported_test_cases" class="success-item">
            <strong>ID {{ testCase.id }}:</strong> {{ testCase.test_case_id }} - {{ testCase.title }} ({{ testCase.status }})
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="save-btn" (click)="confirmImport()" 
                [disabled]="!importFile || isImporting">
          {{ isImporting ? 'Importing...' : 'Import Test Cases' }}
        </button>
        <button type="button" class="cancel-btn" (click)="closeImportPopup()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Confirmation Popup for Import -->
  <div class="popup" *ngIf="showImportConfirmation">
    <div class="popup-content medium-popup">
      <div class="popup-header">
        <h3>Confirm Import</h3>
        <button class="close-btn" (click)="closeImportConfirmation()">‚úñ</button>
      </div>

      <div class="confirmation-content">
        <p>Are you sure you want to import <strong>{{ importResults?.success_count }}</strong> test cases?</p>
        <p *ngIf="importResults?.error_count > 0" class="warning-text">
          Note: {{ importResults.error_count }} rows have errors and will be skipped.
        </p>
      </div>

      <div class="form-actions">
        <button type="button" class="save-btn" (click)="proceedWithImport()">Yes, Import</button>
        <button type="button" class="cancel-btn" (click)="closeImportConfirmation()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Add/Edit Test Case Popup -->
  <div class="popup" *ngIf="showTestCasePopup">
    <div class="popup-content large-popup">
      <div class="popup-header">
        <h3>{{ isEditMode ? 'Edit Test Case' : 'Add Test Case' }}</h3>
        <button class="close-btn" (click)="closeTestCasePopup()">‚úñ</button>
      </div>

      <form (ngSubmit)="saveTestCase()" class="form-grid" enctype="multipart/form-data">
        <!-- Test Case ID - First Field -->
        <label>Test Case ID *</label>
        <input type="text" [(ngModel)]="newTestCase.test_case_id" name="test_case_id" 
               [class.error]="formErrors.test_case_id" required 
               placeholder="Enter test case ID (e.g., TC_001)" />
        <div *ngIf="formErrors.test_case_id" class="error-message">{{ formErrors.test_case_id }}</div>

        <label>Title *</label>
        <input type="text" [(ngModel)]="newTestCase.title" name="title" 
               [class.error]="formErrors.title" required 
               placeholder="Enter test case title" />
        <div *ngIf="formErrors.title" class="error-message">{{ formErrors.title }}</div>

        <!-- ‚úÖ CRITICAL FIX: Page Name field with proper binding -->
        <label>Page Name *</label>
        <input type="text" [(ngModel)]="newTestCase.page_name" name="page_name" 
               [class.error]="formErrors.page_name" required 
               placeholder="Enter page name (e.g., Login, Dashboard, Profile)" />
        <div *ngIf="formErrors.page_name" class="error-message">{{ formErrors.page_name }}</div>

        <label>Description *</label>
        <textarea [(ngModel)]="newTestCase.description" name="description" rows="3" 
                  [class.error]="formErrors.description" required
                  placeholder="Describe the test scenario"></textarea>
        <div *ngIf="formErrors.description" class="error-message">{{ formErrors.description }}</div>

        <label>Pre Conditions</label>
        <textarea [(ngModel)]="newTestCase.pre_conditions" name="pre_conditions" rows="2"
        placeholder="Any prerequisites or setup required"></textarea>

        <label>Expected Result *</label>
        <textarea [(ngModel)]="newTestCase.expected_result" name="expected_result" rows="3" 
                  [class.error]="formErrors.expected_result" required
                  placeholder="What is the expected outcome?"></textarea>
        <div *ngIf="formErrors.expected_result" class="error-message">{{ formErrors.expected_result }}</div>

        <label>Actual Result</label>
        <textarea [(ngModel)]="newTestCase.actual_result" name="actual_result" rows="3"
        placeholder="What actually happened during execution?"></textarea>

        <!-- Is Executed -->
        <label class="checkbox-field">
          <input type="checkbox" [(ngModel)]="newTestCase.is_executed" name="is_executed" />
          Is Executed
        </label>

        <!-- Show Test Actions, Execution Date & Status only if executed -->
        <ng-container *ngIf="newTestCase.is_executed">
          <label>Test Actions *</label>
          <textarea [(ngModel)]="newTestCase.test_actions" name="test_actions" rows="3" 
                    [class.error]="formErrors.test_actions" required
                    placeholder="Step-by-step actions to perform the test"></textarea>
          <div *ngIf="formErrors.test_actions" class="error-message">{{ formErrors.test_actions }}</div>

          <label>Executed On</label>
          <input type="datetime-local" [(ngModel)]="newTestCase.executed_on" name="executed_on" 
                class="form-control" />

          <label>Status</label>
          <select [(ngModel)]="newTestCase.status" name="status">
            <option value="Pass">Pass</option>
            <option value="Fail">Fail</option>
            <option value="Not tested yet">Not tested yet</option>
          </select>
        </ng-container>

        <!-- Bug Raised -->
        <label class="checkbox-field">
          <input type="checkbox" [(ngModel)]="newTestCase.bug_raised" name="bug_raised" />
          Bug Raised
        </label>

        <!-- Show bug fields only if bug raised -->
        <ng-container *ngIf="newTestCase.bug_raised">
          <label>Bug Screenshot</label>
          <div class="screenshot-upload-section">
            <!-- File upload option -->
            <div class="file-upload-option">
              <input type="file" (change)="onTestCaseFileSelected($event, 'bug_screenshot')" accept="image/*" />
              <small>Or use clipboard paste below</small>
            </div>
            
            <!-- Clipboard paste option -->
            <div class="clipboard-upload-option">
              <div class="clipboard-area" 
                   [class.active]="isClipboardActive"
                   (click)="activateClipboard()"
                   (paste)="onPasteScreenshot($event)"
                   tabindex="0">
                <div class="clipboard-placeholder" *ngIf="!clipboardImage">
                  <span class="clipboard-icon">üìã</span>
                  <p>Click here and press Ctrl+V to paste screenshot</p>
                  <small>Supports PNG, JPEG, JPG, GIF (max 5MB)</small>
                </div>
                <div class="clipboard-preview" *ngIf="clipboardImage">
                  <img [src]="clipboardImage" alt="Pasted screenshot" class="pasted-screenshot">
                  <button type="button" class="remove-btn" (click)="removePastedScreenshot($event)">‚úñ</button>
                </div>
              </div>
            </div>

            <!-- Current screenshot preview -->
            <div class="current-screenshot" *ngIf="newTestCase.bug_screenshot && !clipboardImage">
              <img [src]="newTestCase.bug_screenshot" alt="Current screenshot" class="screenshot-preview-img">
              <button type="button" class="remove-btn" (click)="removeCurrentScreenshot()">‚úñ</button>
            </div>
          </div>

          <label>Bug Status *</label>
          <select [(ngModel)]="newTestCase.bug_status" name="bug_status" 
                  [class.error]="formErrors.bug_status" required>
            <option value="">Select Bug Status</option>
            <option value="Open">Open</option>
            <option value="In Progress">In Progress</option>
            <option value="Resolved">Resolved</option>
            <option value="Closed">Closed</option>
          </select>
          <div *ngIf="formErrors.bug_status" class="error-message">{{ formErrors.bug_status }}</div>
        </ng-container>

        <!-- Assigned To -->
        <label>Assigned To</label>
        <select [(ngModel)]="newTestCase.assigned_to" name="assigned_to" class="form-control">
          <option [value]="null">-- Select Developer --</option>
          <option *ngFor="let developer of projectDevelopers" [value]="developer.id">
            {{ developer.name }} ({{ developer.role }})
          </option>
        </select>

        <!-- Test Data -->
        <label>Test Data</label>
        <div class="test-data-section">
          <select [(ngModel)]="newTestCase.test_data" name="test_data" class="test-data-select">
            <option [value]="null">-- Select Test Data --</option>
            <option *ngFor="let testData of testDataList" [value]="testData.id">
              {{ getTestDataDisplay(testData) }}
            </option>
          </select>
          <button type="button" class="add-test-data-btn" (click)="openAddTestDataPopup()">+ Add Test Data</button>
        </div>

        <!-- Is Automated -->
        <label class="checkbox-field">
          <input type="checkbox" [(ngModel)]="newTestCase.is_automated" name="is_automated" />
          Is Automated
        </label>

        <!-- Comments -->
        <label>Comments</label>
        <textarea [(ngModel)]="newTestCase.comments" name="comments" rows="2"
        placeholder="Additional notes or comments"></textarea>

        <div class="form-actions">
          <button type="submit" class="save-btn">{{ isEditMode ? 'Update' : 'Save' }}</button>
          <button type="button" class="cancel-btn" (click)="closeTestCasePopup()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Screenshot Viewer Popup -->
  <div class="popup" *ngIf="showScreenshotViewer">
    <div class="popup-content image-viewer">
      <div class="popup-header">
        <h3>Bug Screenshot</h3>
        <button class="close-btn" (click)="closeScreenshotViewer()">‚úñ</button>
      </div>
      <div class="image-container">
        <img [src]="viewingScreenshot" alt="Bug Screenshot" class="full-screenshot">
      </div>
    </div>
  </div>

  <!-- Add/Edit Test Data Popup -->
  <div class="popup" *ngIf="showTestDataPopup">
    <div class="popup-content medium-popup">
      <div class="popup-header">
        <h3>{{ isEditTestDataMode ? 'Edit Test Data' : 'Add Test Data' }}</h3>
        <button class="close-btn" (click)="closeTestDataPopup()">‚úñ</button>
      </div>

      <!-- General error message for test data form -->
      <div *ngIf="formTestDataErrors.general" class="error-message general-error">
        {{ formTestDataErrors.general }}
      </div>

      <form (ngSubmit)="saveTestData()" class="form-grid" enctype="multipart/form-data">
        <label>Data Type *</label>
        <select [(ngModel)]="newTestData.data_type" name="data_type" 
                [class.error]="formTestDataErrors.data_type" required (change)="onDataTypeChange()">
          <option value="">Select Data Type</option>
          <option value="text">Text</option>
          <option value="file">File</option>
          <option value="image">Image</option>
          <option value="other">Other</option>
        </select>
        <div *ngIf="formTestDataErrors.data_type" class="error-message">{{ formTestDataErrors.data_type }}</div>

        <div *ngIf="newTestData.data_type === 'text'">
          <label>Text Data *</label>
          <textarea [(ngModel)]="newTestData.text_data" name="text_data" rows="4" 
                    [class.error]="formTestDataErrors.text_data" required></textarea>
          <div *ngIf="formTestDataErrors.text_data" class="error-message">{{ formTestDataErrors.text_data }}</div>
        </div>

        <div *ngIf="newTestData.data_type === 'file'">
          <label>File Data *</label>
          <input type="file" (change)="onTestDataFileSelected($event, 'file')" accept="*/*" 
                 [class.error]="formTestDataErrors.file_data" required />
          <span *ngIf="newTestData.file_data_name" class="file-name">{{ newTestData.file_data_name }}</span>
          <div *ngIf="formTestDataErrors.file_data" class="error-message">{{ formTestDataErrors.file_data }}</div>
        </div>

        <div *ngIf="newTestData.data_type === 'image'">
          <label>Image Data *</label>
          <input type="file" (change)="onTestDataFileSelected($event, 'image')" accept="image/*" 
                 [class.error]="formTestDataErrors.image_data" required />
          <span *ngIf="newTestData.image_data_name" class="file-name">{{ newTestData.image_data_name }}</span>
          <div *ngIf="formTestDataErrors.image_data" class="error-message">{{ formTestDataErrors.image_data }}</div>
        </div>

        <div *ngIf="newTestData.data_type === 'other'">
          <label>Other Data</label>
          <textarea [(ngModel)]="newTestData.text_data" name="text_data" rows="4"></textarea>
        </div>

        <div class="form-actions">
          <button type="submit" class="save-btn">{{ isEditTestDataMode ? 'Update' : 'Save' }}</button>
          <button type="button" class="cancel-btn" (click)="closeTestDataPopup()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Execute Test Case Popup -->
  <div class="popup" *ngIf="showExecutePopup">
    <div class="popup-content medium-popup">
      <div class="popup-header">
        <h3>Execute Test Case: {{ executingTestCase?.test_case_id }} - {{ executingTestCase?.title }}</h3>
        <button class="close-btn" (click)="closeExecutePopup()">‚úñ</button>
      </div>

      <form (ngSubmit)="saveExecution()" class="form-grid">
        <label>Status *</label>
        <select [(ngModel)]="executionData.status" name="status" 
                [class.error]="formExecutionErrors.status" required>
          <option value="">Select Status</option>
          <option value="Pass">Pass</option>
          <option value="Fail">Fail</option>
        </select>
        <div *ngIf="formExecutionErrors.status" class="error-message">{{ formExecutionErrors.status }}</div>

        <label>Actual Result</label>
        <textarea [(ngModel)]="executionData.actual_result" name="actual_result" rows="3"></textarea>

        <label>Comments</label>
        <textarea [(ngModel)]="executionData.comments" name="comments" rows="2"></textarea>

        <label class="checkbox-field">
          <input type="checkbox" [(ngModel)]="executionData.bug_raised" name="bug_raised" />
          Bug Raised
        </label>

        <ng-container *ngIf="executionData.bug_raised">
          <label>Bug Status *</label>
          <select [(ngModel)]="executionData.bug_status" name="bug_status" 
                  [class.error]="formExecutionErrors.bug_status" required>
            <option value="">Select Bug Status</option>
            <option value="Open">Open</option>
            <option value="In Progress">In Progress</option>
            <option value="Resolved">Resolved</option>
            <option value="Closed">Closed</option>
          </select>
          <div *ngIf="formExecutionErrors.bug_status" class="error-message">{{ formExecutionErrors.bug_status }}</div>
        </ng-container>

        <div class="form-actions">
          <button type="submit" class="save-btn">Save Execution</button>
          <button type="button" class="cancel-btn" (click)="closeExecutePopup()">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>