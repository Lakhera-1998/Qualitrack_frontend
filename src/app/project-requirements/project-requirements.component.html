<div class="requirements-container">
  <div class="header">
    <h2>Requirements for {{ project?.project_name }}</h2>
    <button class="add-btn" (click)="openAddRequirementPopup()">+ Add Requirement</button>
  </div>

  <div class="card">
    <div class="table-container">
      <table class="styled-table">
        <thead>
          <tr>
            <th class="col-title">Title</th>
            <th>Priority</th>
            <th>Reported Date</th>
            <th>Expected Delivery</th>
            <th>Actual Delivery</th>
            <th>Status</th>
            <th class="col-boolean">Is Developed</th>
            <th class="col-boolean">Is Tested</th>
            <th class="col-boolean">Is Delivered</th>
            <th class="col-boolean">UAT Testing Done</th>
            <th class="col-boolean">Bug Raised After UAT</th>
            <th class="col-boolean">Bug Fixed</th>
            <th class="actions-header">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let requirement of requirements">
            <!-- Title wider -->
            <td class="col-title">{{ requirement.requirement_title }}</td>

            <!-- Priority -->
            <td>
              <span class="priority-badge {{ requirement.priority.toLowerCase() }}">
                {{ requirement.priority }}
              </span>
            </td>

            <!-- Dates -->
            <td>{{ requirement.reported_date | date:'mediumDate' }}</td>
            <td>{{ requirement.expected_delivery | date:'mediumDate' }}</td>
            <td>{{ requirement.actual_delivery ? (requirement.actual_delivery | date:'mediumDate') : 'Pending' }}</td>

            <!-- Status -->
            <td>
              <span class="status-badge {{ getRequirementStatus(requirement) }}">
                {{ getRequirementStatus(requirement) }}
              </span>
            </td>

            <!-- ‚úÖ Boolean fields with icons -->
            <td class="col-boolean">
              <span [ngClass]="requirement.is_developed ? 'icon-yes' : 'icon-no'">
                {{ requirement.is_developed ? '‚úî' : '‚úñ' }}
              </span>
            </td>
            <td class="col-boolean">
              <span [ngClass]="requirement.is_tested ? 'icon-yes' : 'icon-no'">
                {{ requirement.is_tested ? '‚úî' : '‚úñ' }}
              </span>
            </td>
            <td class="col-boolean">
              <span [ngClass]="requirement.is_delivered ? 'icon-yes' : 'icon-no'">
                {{ requirement.is_delivered ? '‚úî' : '‚úñ' }}
              </span>
            </td>
            <td class="col-boolean">
              <span [ngClass]="requirement.uat_testing ? 'icon-yes' : 'icon-no'">
                {{ requirement.uat_testing ? '‚úî' : '‚úñ' }}
              </span>
            </td>
            <td class="col-boolean">
              <span [ngClass]="requirement.bug_raised_by_client_after_uat ? 'icon-yes' : 'icon-no'">
                {{ requirement.bug_raised_by_client_after_uat ? '‚úî' : '‚úñ' }}
              </span>
            </td>
            <td class="col-boolean">
              <span [ngClass]="requirement.bug_fixed ? 'icon-yes' : 'icon-no'">
                {{ requirement.bug_fixed ? '‚úî' : '‚úñ' }}
              </span>
            </td>

            <!-- Actions -->
            <td class="actions">
              <button class="edit-btn" (click)="editRequirement(requirement)" title="Edit Requirement">‚úèÔ∏è</button>
              <button class="test-case-btn" (click)="viewTestCases(requirement)" title="View Test Cases">üß™</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Add/Edit Requirement Popup -->
  <div class="popup" *ngIf="showRequirementPopup">
    <div class="popup-content">
      <div class="popup-header">
        <h3>{{ isEditMode ? 'Edit Requirement' : 'Add Requirement' }}</h3>
        <button class="close-btn" (click)="closeRequirementPopup()">‚úñ</button>
      </div>

      <form (ngSubmit)="saveRequirement()" class="form-grid">
        <!-- Title -->
        <label>Requirement Title *</label>
        <input type="text" [(ngModel)]="newRequirement.requirement_title" name="requirement_title" required />

        <!-- Description -->
        <label>Requirement Description *</label>
        <textarea [(ngModel)]="newRequirement.requirement" name="requirement" rows="3" required></textarea>

        <!-- Priority -->
        <label>Priority *</label>
        <select [(ngModel)]="newRequirement.priority" name="priority">
          <option value="Low">Low</option>
          <option value="Medium">Medium</option>
          <option value="High">High</option>
          <option value="Critical">Critical</option>
        </select>

        <!-- Dates -->
        <label>Reported Date *</label>
        <input type="date" [(ngModel)]="newRequirement.reported_date" name="reported_date" required />

        <label>Expected Delivery</label>
        <input type="date" [(ngModel)]="newRequirement.expected_delivery" name="expected_delivery" />

        <label>Actual Delivery</label>
        <input type="date" [(ngModel)]="newRequirement.actual_delivery" name="actual_delivery" />

        <!-- Boolean fields -->
        <div class="boolean-fields">
          <div class="checkbox-field">
            <input type="checkbox" [(ngModel)]="newRequirement.is_developed" name="is_developed" />
            <label>Is Developed</label>
          </div>
          <div class="checkbox-field">
            <input type="checkbox" [(ngModel)]="newRequirement.is_tested" name="is_tested" />
            <label>Is Tested</label>
          </div>
          <div class="checkbox-field">
            <input type="checkbox" [(ngModel)]="newRequirement.is_delivered" name="is_delivered" />
            <label>Is Delivered</label>
          </div>
          <div class="checkbox-field">
            <input type="checkbox" [(ngModel)]="newRequirement.uat_testing" name="uat_testing" />
            <label>UAT Testing Done</label>
          </div>
          <div class="checkbox-field">
            <input type="checkbox" [(ngModel)]="newRequirement.bug_raised_by_client_after_uat" name="bug_raised_by_client_after_uat" />
            <label>Bug Raised After UAT</label>
          </div>
          <div class="checkbox-field">
            <input type="checkbox" [(ngModel)]="newRequirement.bug_fixed" name="bug_fixed" />
            <label>Bug Fixed</label>
          </div>
        </div>

        <!-- Buttons -->
        <div class="form-actions">
          <button type="submit" class="save-btn">{{ isEditMode ? 'Update' : 'Save' }}</button>
          <button type="button" class="cancel-btn" (click)="closeRequirementPopup()">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>
